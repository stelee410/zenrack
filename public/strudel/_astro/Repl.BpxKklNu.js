import{j as e}from"./jsx-runtime.CLpGMVip.js";import{n as rt,k as xe,u as O,r as it,m as lt,o as ct,q as dt,v as $,w as ut,x as Be,y as z,z as v,A as pt,B as mt,C as me,D as ht,E as U,F as ft,p as be,G as Fe,H as G,I as gt,J as xt,b as bt,K as wt,L as yt,M as vt,s as jt,f as Y,N as J,O as Nt,P as Ce,Q as St,g as Ct,R as Et,S as kt,T as Tt}from"./prebake.D72SZ86e.js";import{c as C,S as At,a as Pt,A as Mt,b as Rt}from"./PatternsTab.BeV3_8mQ.js";import{u as se}from"./useEvent.CgYsmZOj.js";import{a0 as _t,l as oe,W as Ot,e as It,D as Lt,a1 as Dt}from"./index.BSWU8L_a.js";import{q as Bt,g as He}from"./index.BA8GaJAW.js";import{r as g,R as Ft}from"./index.B9mnsnPE.js";import{w as Ue,j as Ht,y as Ut,S as $t,z as Ee}from"./codemirror.D653xNdT.js";import{f as zt,h as Wt,j as Kt,D as qt,k as ke,g as re,l as Vt,w as $e,m as Zt,i as Gt,n as Xt,p as Yt,q as Jt,t as Qt,u as en,v as tn}from"./spectrum.yFlpiLwZ.js";/* empty css                      */import{clearHydra as Te}from"./hydra.DkeA8Wtp.js";import{oscTrigger as nn}from"./osc.DL8Rao_0.js";import{_ as Ae}from"./preload-helper.DPz-dNus.js";import"./_commonjsHelpers.BosuxZz1.js";const sn=t=>_t(t,Ue);function F({onChange:t,className:n,...s}){return e.jsx("input",{className:C("p-2 bg-background rounded-md  border-foreground text-foreground placeholder-foreground",n),onChange:o=>t(o.target.value),...s})}function we({active:t}){return e.jsx("div",{className:"overflow-hidden opacity-50 fixed top-0 left-0 w-full z-[1000]",children:e.jsx("div",{className:C("h-[2px] block w-full",t?"bg-foreground animate-train":"bg-transparent"),children:e.jsx("div",{})})})}const he=Bt([]);function an(t){se(oe.key,t)}function on(t,n){const{message:s,type:o,data:a}=n.detail,c=t.length?t[t.length-1]:void 0,m=rt(12);if(o==="loaded-sample"){const u=t.findIndex(({data:{url:f},type:l})=>l==="load-sample"&&f===a.url);t[u]={message:s,type:o,id:m,data:a}}else c&&c.message===s?t=t.slice(0,-1).concat([{message:s,type:o,count:(c.count??1)+1,id:m,data:a}]):t=t.concat([{message:s,type:o,id:m,data:a}]);return t.slice(-20)}function rn(){an(t=>{const n=he.get(),s=on(n,t);he.set(s)})}function ln(){const t=xe(he),{fontFamily:n}=O();return e.jsx("div",{id:"console-tab",className:"break-all w-full  first-line:text-sm p-2  h-full",style:{fontFamily:n},children:e.jsx("div",{className:"bg-background h-full w-full overflow-auto space-y-1 p-2 rounded-md",children:t.map((s,o)=>{const a=cn(s.message),c=s.data?.hap?.value?.color;return e.jsxs("div",{className:C(s.type==="error"?"text-background bg-foreground":"text-foreground",s.type==="highlight"&&"underline"),style:c?{color:c}:{},children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),s.count?` (${s.count})`:""]},s.id)})})})}function cn(t){var n,s,o,a;return s=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,n=t.replace(s,'<a class="underline" href="$1" target="_blank">$1</a>'),o=/(^|[^\/])(www\.[\S]+(\b|$))/gim,n=n.replace(o,'$1<a class="underline" href="http://$2" target="_blank">$2</a>'),a=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,n=n.replace(a,'<a class="underline" href="mailto:$1">$1</a>'),n}function dn(){const[t,n]=g.useState([]);g.useEffect(()=>(it("",{dir:lt,recursive:!0}).then(u=>n([{name:"~/music",children:u}])).catch(u=>{console.log("error loadin files",u)}),()=>{}),[]);const s=g.useMemo(()=>t[t.length-1],[t]),o=g.useMemo(()=>t.slice(1).map(u=>u.name).join("/"),[t]),a=g.useMemo(()=>s?.children.filter(u=>!!u.children),[s]),c=g.useMemo(()=>s?.children.filter(u=>!u.children&&ct(u.name)),[s]),m=u=>n(f=>f.concat([u]));return e.jsxs("div",{className:"px-4 flex flex-col h-full",children:[e.jsx("div",{className:"flex justify-between font-mono pb-1",children:e.jsxs("div",{children:[e.jsx("span",{children:"samples('"}),t?.map((u,f)=>f<t.length-1?e.jsxs(g.Fragment,{children:[e.jsx("span",{className:"cursor-pointer underline",onClick:()=>n(l=>l.slice(0,f+1)),children:u.name}),e.jsx("span",{children:"/"})]},f):e.jsx("span",{className:"cursor-pointer underline",children:u.name},f)),e.jsx("span",{children:"')"})]})}),e.jsxs("div",{className:"overflow-auto",children:[!a?.length&&!c?.length&&e.jsx("span",{className:"text-gray-500",children:"Nothing here"}),a?.map((u,f)=>e.jsx("div",{className:"cursor-pointer",onClick:()=>m(u),children:u.name},f)),c?.map((u,f)=>e.jsx("div",{className:"text-gray-500 cursor-pointer select-none",onClick:async()=>dt(`${o}/${u.name}`),children:u.name},f))]})]})}const un=({name:t,description:n})=>t&&!t.startsWith("_")&&!!n,pn=(()=>{const t=new Set,n=[];for(const s of Ht.docs){if(!un(s))continue;n.push(s);const o=s.synonyms||[];for(const a of o){if(!a||t.has(a))continue;t.add(a);const c=[s.name,...o].filter(m=>m&&m!==a);n.push({...s,name:a,longname:a,synonyms:c,synonyms_text:c.join(", ")})}}return n.sort((s,o)=>s.name.localeCompare(o.name))})(),mn=t=>{var n=document.createElement("div");return n.innerHTML=t,n.textContent||n.innerText||""};function hn(){const[t,n]=g.useState(""),s=g.useMemo(()=>pn.filter(o=>{if(!t)return!0;const a=t.toLowerCase();return o.name.toLowerCase().includes(a)||(o.synonyms?.some(c=>c.toLowerCase().includes(a))??!1)}),[t]);return e.jsxs("div",{className:"flex h-full w-full p-2 overflow-hidden",children:[e.jsxs("div",{className:"h-full  flex flex-col gap-2 w-1/3 max-w-72 ",children:[e.jsx("div",{class:"w-full flex",children:e.jsx(F,{className:"w-full",placeholder:"Search",value:t,onChange:n})}),e.jsx("div",{className:"flex flex-col h-full overflow-y-auto  gap-1.5 bg-background bg-opacity-50  rounded-md",children:s.map((o,a)=>e.jsxs("a",{className:"cursor-pointer text-foreground flex-none hover:bg-lineHighlight overflow-x-hidden  px-1 text-ellipsis",onClick:()=>{const c=document.getElementById(`doc-${a}`);document.getElementById("reference-container").scrollTo(0,c.offsetTop)},children:[o.name," "]},a))})]}),e.jsx("div",{className:"break-normal flex-grow flex-col overflow-y-auto overflow-x-hidden   px-2 flex relative",id:"reference-container",children:e.jsxs("div",{className:"prose dark:prose-invert min-w-full px-1 ",children:[e.jsx("h2",{children:"API Reference"}),e.jsx("p",{children:"This is the long list of functions you can use. Remember that you don't need to remember all of those and that you can already make music with a small set of functions!"}),s.map((o,a)=>e.jsxs("section",{children:[e.jsx("h3",{id:`doc-${a}`,children:o.name}),!!o.synonyms_text&&e.jsxs("p",{children:["Synonyms: ",e.jsx("code",{children:o.synonyms_text})]}),e.jsx("p",{dangerouslySetInnerHTML:{__html:o.description}}),e.jsx("ul",{children:o.params?.map(({name:c,type:m,description:u},f)=>e.jsxs("li",{children:[c," : ",m?.names?.join(" | ")," ",u?e.jsxs(e.Fragment,{children:[" - ",mn(u)]}):""]},f))}),o.examples?.map((c,m)=>e.jsx("pre",{className:"bg-background",children:c},m))]},a))]})})]})}function ae({value:t,onChange:n,items:s}){return e.jsx("div",{className:"flex max-w-lg",children:Object.entries(s).map(([o,a],c,m)=>e.jsx("button",{id:o,onClick:()=>n(o),className:C("px-2 border-b h-8 whitespace-nowrap",t===o?"border-foreground":"border-transparent"),children:a.toLowerCase()},o))})}function ze({value:t,options:n,onChange:s,onClick:o,isDisabled:a}){return e.jsxs("select",{disabled:a,onClick:o,className:"p-2 bg-background rounded-md text-foreground  border-foreground",value:t??"",onChange:c=>s(c.target.value),children:[n.size==0&&e.jsx("option",{value:t,children:`${t??"select an option"}`}),Array.from(n.keys()).map(c=>e.jsx("option",{className:"bg-background",value:c,children:n.get(c)},c))]})}const fn=new Map;function gn({audioDeviceName:t,onChange:n,isDisabled:s}){const[o,a]=g.useState(fn),c=o.size>0,m=()=>{c||zt().then(l=>{a(l)})},u=l=>{c&&n(l)},f=new Map;return Array.from(o.keys()).forEach(l=>{f.set(l,l)}),e.jsx(ze,{isDisabled:s,options:f,onClick:m,value:t,onChange:u})}function xn({target:t,onChange:n,isDisabled:s}){const o=c=>{n(c)},a=new Map([[$.webaudio,$.webaudio],[$.osc,$.osc]]);return e.jsxs("div",{className:" flex flex-col gap-1",children:[e.jsx(ze,{isDisabled:s,options:a,value:t,onChange:o}),t===$.osc&&e.jsx("div",{children:e.jsxs("p",{className:"text-sm italic",children:["‚ö† All events routed to OSC, audio is silenced! See"," ",e.jsx("a",{className:"text-blue-500",href:"https://strudel.cc/learn/input-output/",children:"Docs"})]})})]})}async function bn(t){const n=new FileReader;n.readAsText(t),n.onload=()=>{const s=n.result;ut(s)},n.onerror=()=>{Ot(new Error("failed to import prebake script"),"importScript")}}function wn(){return O(),e.jsx(At,{type:"file",label:"import prebake script",accept:".strudel",onChange:t=>bn(t.target.files[0])})}function P({label:t,value:n,onChange:s,disabled:o=!1}){return e.jsxs("label",{children:[e.jsx("input",{disabled:o,type:"checkbox",checked:n,onChange:s})," "+t]})}function Pe({value:t,options:n,onChange:s}){return e.jsx("select",{className:"p-2 bg-background rounded-md text-foreground  border-foreground",value:t,onChange:o=>s(o.target.value),children:Object.entries(n).map(([o,a])=>e.jsx("option",{className:"bg-background",value:o,children:a},o))})}function yn({value:t,onChange:n,step:s=1,...o}){return e.jsxs("div",{className:"flex space-x-2 gap-1",children:[e.jsx("input",{className:"p-2 grow",type:"range",value:t,step:s,onChange:a=>n(Number(a.target.value)),...o}),e.jsx("input",{type:"number",value:t,step:s,className:"w-16 bg-background rounded-md",onChange:a=>n(Number(a.target.value))})]})}function M({label:t,children:n,sublabel:s}){return e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{children:t}),n]})}const vn=Object.fromEntries(Object.keys(Ut).map(t=>[t,t])),jn={monospace:"monospace",Courier:"Courier",CutiePi:"CutiePi",JetBrains:"JetBrains",Hack:"Hack",FiraCode:"FiraCode","FiraCode-SemiBold":"FiraCode SemiBold",teletext:"teletext",tic80:"tic80",mode7:"mode7",BigBlueTerminal:"BigBlueTerminal",x3270:"x3270",Monocraft:"Monocraft",PressStart:"PressStart2P","we-come-in-peace":"we-come-in-peace",galactico:"galactico"},Q="Changing this setting requires the window to reload itself. OK?";function Nn({started:t}){const{theme:n,keybindings:s,isBracketClosingEnabled:o,isBracketMatchingEnabled:a,isLineNumbersDisplayed:c,isPatternHighlightingEnabled:m,isActiveLineHighlighted:u,isAutoCompletionEnabled:f,isTooltipEnabled:l,isFlashEnabled:i,isButtonRowHidden:h,isCSSAnimationDisabled:x,isSyncEnabled:S,isLineWrappingEnabled:y,fontSize:p,fontFamily:E,panelPosition:A,audioDeviceName:T,audioEngineTarget:_,togglePanelTrigger:D,maxPolyphony:b,multiChannelOrbits:N,isTabIndentationEnabled:X,isMultiCursorEnabled:H,patternAutoStart:K,includePrebakeScriptInShare:q}=O(),k=Be(),d=AudioContext.prototype.setSinkId!=null;return e.jsxs("div",{className:"text-foreground p-4 space-y-4 w-full",style:{fontFamily:E},children:[d&&e.jsx(M,{label:"Audio Output Device",children:e.jsx(gn,{isDisabled:t,audioDeviceName:T,onChange:r=>{z(Q).then(w=>{if(w==!0)return v.setKey("audioDeviceName",r),window.location.reload()})}})}),e.jsx(M,{label:"Audio Engine Target",children:e.jsx(xn,{target:_,onChange:r=>{z(Q).then(w=>{if(w==!0)return v.setKey("audioEngineTarget",r),window.location.reload()})}})}),e.jsx(M,{label:"Maximum Polyphony",children:e.jsx(F,{min:1,max:1/0,onBlur:r=>{let w=parseInt(r.target.value);w=isNaN(w)?qt:w,Wt(w),v.setKey("maxPolyphony",w)},onChange:r=>{r=Math.max(1,parseInt(r)),v.setKey("maxPolyphony",isNaN(r)?void 0:r)},type:"number",placeholder:"",value:b??""})}),e.jsx(M,{children:e.jsx(P,{label:"Multi Channel Orbits",onChange:r=>{const w=r.target.checked;z(Q).then(j=>{if(j==!0)return v.setKey("multiChannelOrbits",w),Kt(w),window.location.reload()})},value:N})}),e.jsx(M,{label:"Theme",children:e.jsx(Pe,{options:vn,value:n,onChange:r=>v.setKey("theme",r)})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 font-sans",children:[e.jsx(M,{label:"Font Family",children:e.jsx(Pe,{options:jn,value:E,onChange:r=>v.setKey("fontFamily",r)})}),e.jsx(M,{label:"Font Size",children:e.jsx(yn,{value:p,onChange:r=>v.setKey("fontSize",r),min:10,max:40,step:2})})]}),e.jsxs(M,{label:"Prebake",children:[e.jsx(wn,{}),e.jsx(P,{label:"Include prebake script in share",onChange:r=>v.setKey("includePrebakeScriptInShare",r.target.checked),value:q})]}),e.jsx(M,{label:"Keybindings",children:e.jsx(ae,{value:s,onChange:r=>v.setKey("keybindings",r),items:{codemirror:"Codemirror",vim:"Vim",emacs:"Emacs",vscode:"VSCode"}})}),e.jsx(M,{label:"Panel Position",children:e.jsx(ae,{value:A,onChange:r=>v.setKey("panelPosition",r),items:{bottom:"Bottom",right:"Right"}})}),e.jsx(M,{label:"Open Panel on:                       ",children:e.jsx(ae,{value:D,onChange:r=>v.setKey("togglePanelTrigger",r),items:{click:"Click",hover:"Hover"}})}),e.jsxs(M,{label:"More Settings",children:[e.jsx(P,{label:"Enable bracket matching",onChange:r=>v.setKey("isBracketMatchingEnabled",r.target.checked),value:a}),e.jsx(P,{label:"Auto close brackets",onChange:r=>v.setKey("isBracketClosingEnabled",r.target.checked),value:o}),e.jsx(P,{label:"Display line numbers",onChange:r=>v.setKey("isLineNumbersDisplayed",r.target.checked),value:c}),e.jsx(P,{label:"Highlight active line",onChange:r=>v.setKey("isActiveLineHighlighted",r.target.checked),value:u}),e.jsx(P,{label:"Highlight events in code",onChange:r=>v.setKey("isPatternHighlightingEnabled",r.target.checked),value:m}),e.jsx(P,{label:"Enable auto-completion",onChange:r=>v.setKey("isAutoCompletionEnabled",r.target.checked),value:f}),e.jsx(P,{label:"Enable tooltips on Ctrl and hover",onChange:r=>v.setKey("isTooltipEnabled",r.target.checked),value:l}),e.jsx(P,{label:"Enable line wrapping",onChange:r=>v.setKey("isLineWrappingEnabled",r.target.checked),value:y}),e.jsx(P,{label:"Enable Tab indentation",onChange:r=>v.setKey("isTabIndentationEnabled",r.target.checked),value:X}),e.jsx(P,{label:"Enable Multi-Cursor (Cmd/Ctrl+Click)",onChange:r=>v.setKey("isMultiCursorEnabled",r.target.checked),value:H}),e.jsx(P,{label:"Enable flashing on evaluation",onChange:r=>v.setKey("isFlashEnabled",r.target.checked),value:i}),e.jsx(P,{label:"Sync across Browser Tabs / Windows",onChange:r=>{const w=r.target.checked;z(Q).then(j=>{j&&(v.setKey("isSyncEnabled",w),window.location.reload())})},disabled:k,value:S}),e.jsx(P,{label:"Hide top buttons",onChange:r=>v.setKey("isButtonRowHidden",r.target.checked),value:h}),e.jsx(P,{label:"Disable CSS Animations",onChange:r=>v.setKey("isCSSAnimationDisabled",r.target.checked),value:x}),e.jsx(P,{label:"Auto-start pattern on pattern change",onChange:r=>v.setKey("patternAutoStart",r.target.checked),value:K})]}),e.jsx(M,{label:"Zen Mode",children:"Try clicking the logo in the top left!"}),e.jsx(M,{label:"Reset Settings",children:e.jsx(Pt,{onClick:()=>{z("Sure?").then(r=>{if(r){const{userPatterns:w}=v.get();v.set({...pt,userPatterns:w})}})},children:"restore default settings"})})]})}function Sn({onComplete:t}){let n=Ft.createRef();const[s,o]=g.useState(!1),a=g.useCallback(async()=>{n.current.files?.length&&(o(!0),await mt(me,n.current.files).then(()=>{ht(me,()=>{t(),o(!1)})}))});return e.jsx("div",{children:e.jsxs("label",{style:{alignItems:"center",borderColor:"red",border:1},className:"flex bg-background  p-4  w-fit rounded-xl hover:opacity-50 whitespace-nowrap cursor-pointer",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"size-6 mr-2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 7.5h-.75A2.25 2.25 0 0 0 4.5 9.75v7.5a2.25 2.25 0 0 0 2.25 2.25h7.5a2.25 2.25 0 0 0 2.25-2.25v-7.5a2.25 2.25 0 0 0-2.25-2.25h-.75m0-3-3-3m0 0-3 3m3-3v11.25m6-2.25h.75a2.25 2.25 0 0 1 2.25 2.25v7.5a2.25 2.25 0 0 1-2.25 2.25h-7.5a2.25 2.25 0 0 1-2.25-2.25v-.75"})}),e.jsx("input",{disabled:s,ref:n,id:"audio_file",style:{display:"none"},type:"file",directory:"",webkitdirectory:"",multiple:!0,accept:"audio/*, .wav, .mp3, .m4a, .flac, .aac, .ogg",onChange:()=>{a()}}),s?"importing...":"import sounds folder"]})})}const Cn={ASSETS_PREFIX:void 0,BASE_URL:"/strudel/",DEV:!1,MODE:"production",PROD:!0,SITE:"https://strudel.cc/",SSR:!1},Me=t=>Array.isArray(t)?t.length:typeof t=="object"?Object.values(t).length:1;function En(t){return new Promise(n=>setTimeout(n,t))}function kn(){const t=xe(ke),{soundsFilter:n}=O(),[s,o]=g.useState(""),{BASE_URL:a}=Cn,c=a.endsWith("/")?a.slice(0,-1):a,m=g.useMemo(()=>{if(!t)return[];let l=Object.entries(t).filter(([i])=>!i.startsWith("_")).sort((i,h)=>i[0].localeCompare(h[0])).filter(([i])=>i.toLowerCase().includes(s.toLowerCase()));return n===U.USER?l.filter(([i,{data:h}])=>!h.prebake):n===U.DRUMS?l.filter(([i,{data:h}])=>h.type==="sample"&&h.tag==="drum-machines"):n===U.SAMPLES?l.filter(([i,{data:h}])=>h.type==="sample"&&h.tag!=="drum-machines"):n===U.SYNTHS?l.filter(([i,{data:h}])=>["synth","soundfont"].includes(h.type)):n===U.WAVETABLES?l.filter(([i,{data:h}])=>h.type==="wavetable"):n==="importSounds"?[]:l},[t,n,s]),u=g.useRef(),f=g.useRef(0);return se("mouseup",()=>{const l=u.current;u.current=void 0,l?.stop?.(re().currentTime+.01)}),se("keydown",l=>{isNaN(Number(l.key))||(f.current=Number(l.key))}),se("keyup",l=>{f.current=0}),e.jsxs("div",{id:"sounds-tab",className:"px-4 flex gap-2 flex-col w-full h-full text-foreground",children:[e.jsx(F,{placeholder:"Search",value:s,onChange:l=>o(l)}),e.jsx("div",{className:" flex shrink-0 flex-wrap",children:e.jsx(ae,{value:n,onChange:l=>v.setKey("soundsFilter",l),items:{samples:"samples",drums:"drum-machines",synths:"Synths",wavetables:"Wavetables",user:"User",importSounds:"import-sounds"}})}),n===U.USER&&m.length>0&&e.jsx(Mt,{className:"pl-2",label:"delete-all",onClick:async()=>{try{await z("Delete all imported user samples?")&&(ft(me.dbName),ke.set({}),await be())}catch(l){console.error(l)}}}),e.jsxs("div",{className:"min-h-0 max-h-full grow overflow-auto  text-sm break-normal bg-background p-2 rounded-md",children:[m.map(([l,{data:i,onTrigger:h}])=>e.jsxs("span",{className:"cursor-pointer hover:opacity-50",onMouseDown:async()=>{const x=re(),S={note:["synth","soundfont"].includes(i.type)?"a3":void 0,s:l,n:f.current,clip:1,release:.5,sustain:1,duration:.5},y=()=>u.current?.node?.disconnect();let p;for(let E=0;E<10;E++){try{const A=x.currentTime+.05,T=await h(A,S,y);if(u.current=T,T?.node){Vt(T.node);break}}catch(A){p=A}E==9?console.warn("Failed to trigger sound after 10 attempts"+(p?`: ${p}`:"")):await En(200)}},children:[" ",l,i?.type==="sample"?`(${Me(i.samples)})`:"",i?.type==="wavetable"?`(${Me(i.tables)})`:"",i?.type==="soundfont"?`(${i.fonts.length})`:""]},l)),!m.length&&n==="importSounds"?e.jsxs("div",{className:"prose dark:prose-invert min-w-full pt-2 pb-8 px-4",children:[e.jsx(Sn,{onComplete:()=>v.setKey("soundsFilter","user")}),e.jsxs("p",{children:["To import sounds into strudel, they must be contained"," ",e.jsx("a",{href:`${c}/learn/samples/#from-disk-via-import-sounds-folder`,target:"_blank",children:"within a folder or subfolder"}),". The best way to do this is to upload a ‚Äúsamples‚Äù folder containing subfolders of individual sounds or soundbanks (see diagram below)."," "]}),e.jsx("pre",{className:"bg-background",children:`‚îî‚îÄ samples <-- import this folder
   ‚îú‚îÄ swoop
   ‚îÇ  ‚îú‚îÄ swoopshort.wav
   ‚îÇ  ‚îú‚îÄ swooplong.wav
   ‚îÇ  ‚îî‚îÄ swooptight.wav
   ‚îî‚îÄ smash
      ‚îú‚îÄ smashhigh.wav
      ‚îú‚îÄ smashlow.wav
      ‚îî‚îÄ smashmiddle.wav`},"sample-diagram"),e.jsx("p",{children:"The name of a subfolder corresponds to the sound name under the ‚Äúuser‚Äù tab. Multiple samples within a subfolder are all labelled with the same name, but can be accessed using ‚Äú.n( )‚Äù - remember sounds are zero-indexed and in alphabetical order!"}),e.jsxs("p",{children:["For more information, and other ways to use your own sounds in strudel,"," ",e.jsx("a",{href:`${c}/learn/samples/#from-disk-via-import-sounds-folder`,target:"_blank",children:"check out the docs"}),"!"]}),e.jsx("h3",{children:"Preview Sounds"}),e.jsx("pre",{className:"bg-background",children:'n("0 1 2 3 4 5").s("sample-name")'},"sample-preview"),e.jsx("p",{children:'Paste the line above into the main editor to hear the uploaded folder. Remember to use the name of your sample as it appears under the "user" tab.'})]}):"",!m.length&&n!=="importSounds"?"No sounds loaded":""]})]})}const Tn={ASSETS_PREFIX:void 0,BASE_URL:"/strudel/",DEV:!1,MODE:"production",PROD:!0,SITE:"https://strudel.cc/",SSR:!1},{BASE_URL:de}=Tn,An=de.endsWith("/")?de.slice(0,-1):de;function Pn({context:t}){const{fontFamily:n}=O();return e.jsxs("div",{className:"prose dark:prose-invert min-w-full pt-2 font-sans pb-8 px-4 ",style:{fontFamily:n},children:[e.jsx("h3",{children:"Í©ú welcome"}),e.jsxs("p",{children:["You have found ",e.jsx("span",{className:"underline",children:"strudel"}),", a new live coding platform to write dynamic music pieces in the browser! It is free and open-source and made for beginners and experts alike. To get started:",e.jsx("br",{}),e.jsx("br",{}),e.jsx("span",{className:"underline",children:"1. hit play"})," - ",e.jsx("span",{className:"underline",children:"2. change something"})," -"," ",e.jsx("span",{className:"underline",children:"3. hit update"})]}),e.jsxs("p",{children:["To get started, check out the"," ",e.jsx("a",{href:`${An}/workshop/getting-started/`,target:"_blank",children:"interactive tutorial"}),". Also feel free to join the"," ",e.jsx("a",{href:"https://discord.com/invite/HGEdXmRkzT",target:"_blank",children:"discord channel"})," ","to ask any questions, give feedback or just say hello."]}),e.jsx("h3",{children:"Í©ú about"}),e.jsxs("p",{children:["strudel is a JavaScript version of"," ",e.jsx("a",{href:"https://tidalcycles.org/",target:"_blank",children:"tidalcycles"}),", which is a popular live coding language for music, written in Haskell. Strudel is free/open source software: you can redistribute and/or modify it under the terms of the"," ",e.jsx("a",{href:"https://codeberg.org/uzu/strudel/src/branch/main/LICENSE",target:"_blank",children:"GNU Affero General Public License"}),". You can find the source code at"," ",e.jsx("a",{href:"https://codeberg.org/uzu/strudel",target:"_blank",children:"codeberg"}),". You can also find ",e.jsx("a",{href:"https://github.com/felixroos/dough-samples/blob/main/README.md",children:"licensing info"})," ","for the default sound banks there. Please consider to"," ",e.jsx("a",{href:"https://opencollective.com/tidalcycles",target:"_blank",children:"support this project"})," ","to ensure ongoing development üíñ"]})]})}function Mn({title:t,titleId:n,...s},o){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":n},s),t?g.createElement("title",{id:n},t):null,g.createElement("path",{fillRule:"evenodd",d:"M9.78 4.22a.75.75 0 0 1 0 1.06L7.06 8l2.72 2.72a.75.75 0 1 1-1.06 1.06L5.47 8.53a.75.75 0 0 1 0-1.06l3.25-3.25a.75.75 0 0 1 1.06 0Z",clipRule:"evenodd"}))}const Rn=g.forwardRef(Mn);function _n({title:t,titleId:n,...s},o){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":n},s),t?g.createElement("title",{id:n},t):null,g.createElement("path",{d:"M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z"}))}const On=g.forwardRef(_n);function In({title:t,titleId:n,...s},o){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":n},s),t?g.createElement("title",{id:n},t):null,g.createElement("path",{fillRule:"evenodd",d:"M2 10a8 8 0 1 1 16 0 8 8 0 0 1-16 0Zm6.39-2.908a.75.75 0 0 1 .766.027l3.5 2.25a.75.75 0 0 1 0 1.262l-3.5 2.25A.75.75 0 0 1 8 12.25v-4.5a.75.75 0 0 1 .39-.658Z",clipRule:"evenodd"}))}const We=g.forwardRef(In);function Ln({label:t,value:n,onChange:s,disabled:o=!1}){return e.jsxs("label",{className:C(o&&"opacity-50"),children:[e.jsx("input",{disabled:o,type:"checkbox",checked:n,onChange:s})," "+t]})}function Z({label:t,children:n,disabled:s}){return e.jsxs("div",{className:"grid gap-2 w-full",children:[e.jsx("label",{className:C(s&&"opacity-50"),children:t}),n]})}function Dn(t){const{handleExport:n}=t,[s,o]=g.useState(""),[a,c]=g.useState(0),[m,u]=g.useState(1),[f,l]=g.useState(48e3),[i,h]=g.useState(!0),[x,S]=g.useState(1024),[y,p]=g.useState(!1),[E,A]=g.useState(0),[T,_]=g.useState(1),D=()=>{const b=re();b instanceof OfflineAudioContext&&(A(b.currentTime),_(b.length/f),setTimeout(D,100))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-foreground w-full p-4 space-y-4",children:[e.jsx(Z,{label:"File name",disabled:y,children:e.jsx(F,{onBlur:b=>{o(b.target.value)},onChange:b=>{o(b)},disabled:y,placeholder:"Leave empty to use current date",className:C("placeholder:opacity-50",y&&"opacity-50 border-opacity-50"),value:s??""})}),e.jsxs("div",{className:"flex flex-row gap-4 w-full",children:[e.jsx(Z,{label:"Start cycle",disabled:y,children:e.jsx(F,{min:1,max:1/0,onBlur:b=>{let N=parseInt(b.target.value);N=isNaN(N)?0:Math.max(0,N),c(N)},onChange:b=>{b=parseInt(b),c(b)},type:"number",placeholder:"",disabled:y,className:C(y&&"opacity-50 border-opacity-50","w-full"),value:a??""})}),e.jsx(Z,{label:"End cycle",disabled:y,children:e.jsx(F,{min:1,max:1/0,onBlur:b=>{let N=parseInt(b.target.value);N=isNaN(N)?Math.max(a+1,parseInt(N)):N,u(N)},onChange:b=>{b=parseInt(b),u(b)},type:"number",placeholder:"",disabled:y,className:C(y&&"opacity-50 border-opacity-50","w-full"),value:m??""})})]}),e.jsxs("div",{className:"flex flex-row gap-4",children:[e.jsx(Z,{label:"Sample rate",disabled:y,children:e.jsx(F,{min:1,max:1/0,onBlur:b=>{let N=parseInt(b.target.value);N=isNaN(N)?1:Math.max(1,N),l(N)},onChange:b=>{b=parseInt(b),l(b)},type:"number",placeholder:"",disabled:y,className:C(y&&"opacity-50 border-opacity-50"),value:f??""})}),e.jsx(Z,{label:"Maximum polyphony",disabled:y,children:e.jsx(F,{min:1,max:1/0,onBlur:b=>{let N=parseInt(b.target.value);N=isNaN(N)?Math.max(1,parseInt(N)):N,S(N)},onChange:b=>{b=Math.max(1,parseInt(b)),S(b)},type:"number",placeholder:"",disabled:y,className:C(y&&"opacity-50 border-opacity-50"),value:x??""})})]}),e.jsx("div",{children:e.jsx(Ln,{label:"Multi Channel Orbits",onChange:b=>{const N=b.target.checked;h(N)},disabled:y,value:i})}),e.jsxs("button",{className:C("bg-background p-2 w-full rounded-md hover:opacity-75 relative",y&&"opacity-50"),disabled:y,onClick:async()=>{p(!0),setTimeout(D,2e3),document.getElementById("exportProgressModal").showModal(),await n(a,m,f,x,i,s).then(()=>{document.getElementById("exportProgressModal").close()}).finally(()=>{p(!1),A(0),_(1)})},children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 bottom-0 backdrop-invert",style:{width:`${(y?1:0)+E/T*99}%`}}),e.jsx("span",{className:"text-foreground",children:y?"Exporting...":"Export to WAV"})]})]}),e.jsx("dialog",{closedby:y?"none":"closerequest",id:"exportProgressModal",className:"text-md bg-background text-foreground rounded-lg backdrop:bg-background backdrop:opacity-25"})]})}const Bn=typeof window<"u"&&window.__TAURI__;function Ke({context:t}){const n=O(),{isPanelOpen:s,activeFooter:o}=n;return e.jsxs(qe,{settings:n,className:C(s?"min-h-[360px] max-h-[360px]":"min-h-12 max-h-12","overflow-hidden flex flex-col"),children:[s&&e.jsx("div",{className:"flex h-full overflow-auto pr-10 ",children:e.jsx(Ve,{context:t,tab:o})}),e.jsx("div",{className:"absolute right-4 pt-4",children:e.jsx(Ge,{settings:n})}),e.jsx("div",{className:"flex  justify-between min-h-12 max-h-12 grid-cols-2 items-center",children:e.jsx(Ze,{setTab:Fe,tab:o})})]})}function Fn({context:t}){const n=O(),{activeFooter:s,isPanelOpen:o}=n;return e.jsx(qe,{settings:n,className:C(o?"min-w-[min(600px,80vw)] max-w-[min(600px,80vw)]":"min-w-12 max-w-12"),children:o?e.jsxs("div",{className:C("flex flex-col h-full"),children:[e.jsxs("div",{className:"flex justify-between w-full ",children:[e.jsx(Ze,{setTab:Fe,tab:s}),e.jsx(Ge,{settings:n})]}),e.jsx("div",{className:"overflow-auto h-full",children:e.jsx(Ve,{context:t,tab:s})})]}):e.jsx("button",{onClick:a=>{G(!0)},"aria-label":"open menu panel",className:C("flex flex-col hover:bg-lineBackground items-center cursor-pointer justify-center w-full  h-full"),children:e.jsx(Rn,{className:"text-foreground opacity-50 w-6 h-6"})})})}const L={welcome:"intro",patterns:"patterns",sounds:"sounds",reference:"reference",export:"export",console:"console",settings:"settings"};Bn&&(L.files="files");function qe({children:t,className:n,settings:s,...o}){const a=s.togglePanelTrigger==="hover";return e.jsx("nav",{onClick:()=>{s.isPanelOpen||G(!0)},onMouseEnter:()=>{a&&!s.isPanelOpen&&G(!0)},onMouseLeave:()=>{a&&!s.isPanelPinned&&G(!1)},"aria-label":"Menu Panel",className:C("bg-lineHighlight group overflow-x-auto",n),...o,children:t})}function Ve({context:t,tab:n}){switch(rn(),n){case L.patterns:return e.jsx(Rt,{context:t});case L.console:return e.jsx(ln,{});case L.sounds:return e.jsx(kn,{});case L.reference:return e.jsx(hn,{});case L.export:return e.jsx(Dn,{handleExport:t.handleExport});case L.settings:return e.jsx(Nn,{started:t.started});case L.files:return e.jsx(dn,{});default:return e.jsx(Pn,{context:t})}}function Hn({label:t,isSelected:n,onClick:s}){return e.jsx(e.Fragment,{children:e.jsx("button",{onClick:s,className:C("h-8 px-2 text-foreground cursor-pointer hover:opacity-50 flex items-center space-x-1 border-b",n?"border-foreground":"border-transparent"),children:t})})}function Ze({setTab:t,tab:n,className:s}){return e.jsx("div",{className:C("flex select-none max-w-full overflow-auto pb-2",s),children:Object.keys(L).map(o=>{const a=L[o];return e.jsx(Hn,{isSelected:n===a,label:o,onClick:()=>t(a)},o)})})}function Ge({settings:t}){const{togglePanelTrigger:n,isPanelPinned:s,isPanelOpen:o}=t,a=n==="hover";if(o)return a?e.jsx(Un,{pinned:s}):e.jsx($n,{onClick:()=>G(!1)})}function Un({pinned:t}){return e.jsx("button",{onClick:()=>gt(!t),className:C("text-foreground max-h-8 min-h-8 max-w-8 min-w-8 items-center justify-center p-1.5 group-hover:flex",t?"flex":"hidden"),"aria-label":"Pin Menu Panel",children:e.jsx("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",className:"w-full h-full",opacity:t?1:".3",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9.828.722a.5.5 0 0 1 .354.146l4.95 4.95a.5.5 0 0 1 0 .707c-.48.48-1.072.588-1.503.588-.177 0-.335-.018-.46-.039l-3.134 3.134a6 6 0 0 1 .16 1.013c.046.702-.032 1.687-.72 2.375a.5.5 0 0 1-.707 0l-2.829-2.828-3.182 3.182c-.195.195-1.219.902-1.414.707s.512-1.22.707-1.414l3.182-3.182-2.828-2.829a.5.5 0 0 1 0-.707c.688-.688 1.673-.767 2.375-.72a6 6 0 0 1 1.013.16l3.134-3.133a3 3 0 0 1-.04-.461c0-.43.108-1.022.589-1.503a.5.5 0 0 1 .353-.146"})})})}function $n({onClick:t}){return e.jsx("button",{onClick:t,className:C("text-foreground max-h-8 min-h-8 max-w-8 min-w-8 items-center justify-center p-1.5 group-hover:flex"),"aria-label":"Close Menu",children:e.jsx(On,{})})}function ye(t){const{editorRef:n,containerRef:s,init:o}=t;return e.jsx("section",{className:"text-gray-100 cursor-text pb-0 overflow-auto grow",id:"code",ref:a=>{s.current=a,n.current||o()}})}function Xe(t){const{started:n,handleTogglePlay:s}=t;if(!n)return e.jsxs("button",{onClick:()=>s(),className:"text-white text-2xl fixed left-[50%] top-[50%] translate-x-[-50%] translate-y-[-50%] z-[1000] m-auto p-4 bg-black rounded-md flex items-center space-x-2",children:[e.jsx(We,{className:"w-6 h-6"}),e.jsx("span",{children:"play"})]})}function ve(t){const{error:n}=t;if(n!=null)return e.jsxs("div",{className:"text-background px-2 py-1 bg-foreground w-full ml-auto",children:["Error: ",n.message||"Unknown Error :-/"]})}function zn(t){const{context:n,...s}=t,{containerRef:o,editorRef:a,error:c,init:m,pending:u,started:f,handleTogglePlay:l}=n;return e.jsxs("div",{className:"h-full flex w-full flex-col relative",...s,children:[e.jsx(we,{active:u}),e.jsx(Xe,{started:f,handleTogglePlay:l}),e.jsx("div",{className:"grow flex relative overflow-hidden",children:e.jsx(ye,{containerRef:o,editorRef:a,init:m})}),e.jsx(ve,{error:c}),e.jsx(Ke,{context:n})]})}function Wn({title:t,titleId:n,...s},o){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":n},s),t?g.createElement("title",{id:n},t):null,g.createElement("path",{fillRule:"evenodd",d:"M2 10a8 8 0 1 1 16 0 8 8 0 0 1-16 0Zm5-2.25A.75.75 0 0 1 7.75 7h4.5a.75.75 0 0 1 .75.75v4.5a.75.75 0 0 1-.75.75h-4.5a.75.75 0 0 1-.75-.75v-4.5Z",clipRule:"evenodd"}))}const Kn=g.forwardRef(Wn),qn={ASSETS_PREFIX:void 0,BASE_URL:"/strudel/",DEV:!1,MODE:"production",PROD:!0,SITE:"https://strudel.cc/",SSR:!1},{BASE_URL:ue}=qn,Re=ue.endsWith("/")?ue.slice(0,-1):ue;function Ye({context:t,embedded:n=!1}){const{started:s,pending:o,isDirty:a,activeCode:c,handleTogglePlay:m,handleEvaluate:u,handleShuffle:f,handleShare:l}=t,i=typeof window<"u"&&(n||window.location!==window.parent.location),{isZen:h,isButtonRowHidden:x,isCSSAnimationDisabled:S,fontFamily:y}=O();return e.jsxs("header",{id:"header",className:C("flex-none text-black  z-[100] text-lg select-none h-20 md:h-14",!h&&!i&&"bg-lineHighlight",h?"h-12 w-8 fixed top-0 left-0":"sticky top-0 w-full py-1 justify-between",i?"flex":"md:flex"),style:{fontFamily:y},children:[e.jsx("div",{className:"px-4 flex space-x-2 md:pt-0 select-none",children:e.jsxs("h1",{onClick:()=>{i&&window.open(window.location.href.replace("embed",""))},className:C(i?"text-l cursor-pointer":"text-xl","text-foreground font-bold flex space-x-2 items-center"),children:[e.jsx("div",{className:C("mt-[1px]",s&&!S&&"animate-spin","cursor-pointer text-blue-500",h&&"fixed top-2 right-4"),onClick:()=>{i||xt(!h)},children:e.jsx("span",{className:"block text-foreground rotate-90",children:"Í©ú"})}),!h&&e.jsxs("div",{className:"space-x-2",children:[e.jsx("span",{className:"",children:"strudel"}),e.jsx("span",{className:"text-sm font-medium",children:"REPL"}),!i&&x&&e.jsx("a",{href:`${Re}/learn`,className:"text-sm opacity-25 font-medium",children:"DOCS"})]})]})}),!h&&!x&&e.jsxs("div",{className:"flex max-w-full overflow-auto text-foreground px-1 md:px-2",children:[e.jsx("button",{onClick:m,title:s?"stop":"play",className:C(i?"px-2":"p-2","hover:opacity-50",!s&&!S&&"animate-pulse"),children:o?e.jsx(e.Fragment,{children:"loading..."}):e.jsxs("span",{className:C("flex items-center space-x-2"),children:[s?e.jsx(Kn,{className:"w-6 h-6"}):e.jsx(We,{className:"w-6 h-6"}),!i&&e.jsx("span",{children:s?"stop":"play"})]})}),e.jsx("button",{onClick:u,title:"update",className:C("flex items-center space-x-1",i?"px-2":"p-2",!a||!c?"opacity-50":"hover:opacity-50"),children:!i&&e.jsx("span",{children:"update"})}),!i&&e.jsx("button",{title:"share",className:C("cursor-pointer hover:opacity-50 flex items-center space-x-1",i?"px-2":"p-2"),onClick:l,children:e.jsx("span",{children:"share"})}),!i&&e.jsx("a",{title:"learn",href:`${Re}/workshop/getting-started/`,className:C("hover:opacity-50 flex items-center space-x-1",i?"px-2":"p-2"),children:e.jsx("span",{children:"learn"})})]})]})}function Vn(t){const{context:n,...s}=t,{containerRef:o,editorRef:a,error:c,init:m,pending:u}=n,f=O(),{panelPosition:l,isZen:i}=f;return e.jsxs("div",{className:"h-full flex flex-col relative",...s,children:[e.jsx(we,{active:u}),e.jsx(Ye,{context:n}),e.jsxs("div",{className:"grow flex relative overflow-hidden",children:[e.jsx(ye,{containerRef:o,editorRef:a,init:m}),!i&&l==="right"&&e.jsx(Fn,{context:n})]}),e.jsx(ve,{error:c}),!i&&l==="bottom"&&e.jsx(Ke,{context:n})]})}function Zn(t){const{context:n,...s}=t,{pending:o,started:a,handleTogglePlay:c,containerRef:m,editorRef:u,error:f,init:l}=n;return e.jsxs("div",{className:"h-full flex flex-col relative",...s,children:[e.jsx(we,{active:o}),e.jsx(Ye,{context:n,embedded:!0}),e.jsx(Xe,{started:a,handleTogglePlay:c}),e.jsx("div",{className:"grow flex relative overflow-hidden",children:e.jsx(ye,{containerRef:m,editorRef:u,init:l})}),e.jsx(ve,{error:f})]})}const Gn=nn,Xn=(t,n,s,o,a)=>{const c=performance.now()/1e3;return Gn(t,c,o,a)},Yn=t=>(n,s)=>(t.set(n,s),s),_e=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,Je=536870912,Oe=Je*2,Jn=(t,n)=>s=>{const o=n.get(s);let a=o===void 0?s.size:o<Oe?o+1:0;if(!s.has(a))return t(s,a);if(s.size<Je){for(;s.has(a);)a=Math.floor(Math.random()*Oe);return t(s,a)}if(s.size>_e)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;s.has(a);)a=Math.floor(Math.random()*_e);return t(s,a)},Qe=new WeakMap,Qn=Yn(Qe),ee=Jn(Qn,Qe),es=t=>t.method!==void 0&&t.method==="call",ts=t=>typeof t.id=="number"&&typeof t.result=="boolean",ns=t=>{const n=new Map([[0,()=>{}]]),s=new Map([[0,()=>{}]]),o=new Map,a=new Worker(t);return a.addEventListener("message",({data:l})=>{if(es(l)){const{params:{timerId:i,timerType:h}}=l;if(h==="interval"){const x=n.get(i);if(typeof x===void 0)throw new Error("The timer is in an undefined state.");if(typeof x=="number"){const S=o.get(x);if(S===void 0||S.timerId!==i||S.timerType!==h)throw new Error("The timer is in an undefined state.")}else typeof x=="function"&&x()}else if(h==="timeout"){const x=s.get(i);if(typeof x===void 0)throw new Error("The timer is in an undefined state.");if(typeof x=="number"){const S=o.get(x);if(S===void 0||S.timerId!==i||S.timerType!==h)throw new Error("The timer is in an undefined state.")}else typeof x=="function"&&(x(),s.delete(i))}}else if(ts(l)){const{id:i}=l,h=o.get(i);if(h===void 0)throw new Error("The timer is in an undefined state.");const{timerId:x,timerType:S}=h;o.delete(i),S==="interval"?n.delete(x):s.delete(x)}else{const{error:{message:i}}=l;throw new Error(i)}}),{clearInterval:l=>{if(typeof n.get(l)=="function"){const i=ee(o);o.set(i,{timerId:l,timerType:"interval"}),n.set(l,i),a.postMessage({id:i,method:"clear",params:{timerId:l,timerType:"interval"}})}},clearTimeout:l=>{if(typeof s.get(l)=="function"){const i=ee(o);o.set(i,{timerId:l,timerType:"timeout"}),s.set(l,i),a.postMessage({id:i,method:"clear",params:{timerId:l,timerType:"timeout"}})}},setInterval:(l,i=0,...h)=>{const x=ee(n);return n.set(x,()=>{l(...h),typeof n.get(x)=="function"&&a.postMessage({id:null,method:"set",params:{delay:i,now:performance.timeOrigin+performance.now(),timerId:x,timerType:"interval"}})}),a.postMessage({id:null,method:"set",params:{delay:i,now:performance.timeOrigin+performance.now(),timerId:x,timerType:"interval"}}),x},setTimeout:(l,i=0,...h)=>{const x=ee(s);return s.set(x,()=>l(...h)),a.postMessage({id:null,method:"set",params:{delay:i,now:performance.timeOrigin+performance.now(),timerId:x,timerType:"timeout"}}),x}}},ss=(t,n)=>{let s=null;return()=>{if(s!==null)return s;const o=new Blob([n],{type:"application/javascript; charset=utf-8"}),a=URL.createObjectURL(o);return s=t(a),setTimeout(()=>URL.revokeObjectURL(a)),s}},as=`(()=>{"use strict";const e=new Map,t=new Map,r=t=>{const r=e.get(t);return void 0!==r&&(clearTimeout(r),e.delete(t),!0)},s=e=>{const r=t.get(e);return void 0!==r&&(clearTimeout(r),t.delete(e),!0)},o=(e,t)=>{const r=performance.now(),s=e+t-r-performance.timeOrigin;return{expected:r+s,remainingDelay:s}},i=(e,t,r,s)=>{const o=r-performance.now();o>0?e.set(t,setTimeout(i,o,e,t,r,s)):(e.delete(t),postMessage({id:null,method:"call",params:{timerId:t,timerType:s}}))};addEventListener("message",(({data:n})=>{try{if("clear"===n.method){const{id:e,params:{timerId:t,timerType:o}}=n;if("interval"===o)postMessage({id:e,result:r(t)});else{if("timeout"!==o)throw new Error('The given type "'.concat(o,'" is not supported'));postMessage({id:e,result:s(t)})}}else{if("set"!==n.method)throw new Error('The given method "'.concat(n.method,'" is not supported'));{const{params:{delay:r,now:s,timerId:a,timerType:m}}=n;if("interval"===m)((t,r,s)=>{const{expected:n,remainingDelay:a}=o(t,s);e.set(r,setTimeout(i,a,e,r,n,"interval"))})(r,a,s);else{if("timeout"!==m)throw new Error('The given type "'.concat(m,'" is not supported'));((e,r,s)=>{const{expected:n,remainingDelay:a}=o(e,s);t.set(r,setTimeout(i,a,t,r,n,"timeout"))})(r,a,s)}}}}catch(e){postMessage({error:{message:e.message},id:n.id,result:null})}}))})();`,et=ss(ns,as),os=t=>et().clearInterval(t),rs=(...t)=>et().setInterval(...t);let ie=null,tt=null,te=!1,W=0,R=new Map;const is=JSON.stringify({connect:[],where:[],disconnectAll:0,disconnectOne:0,hasStop:!1,stopCount:0,ac:null,creation:null});let Ie;function fe(){var t=new Error;const s=t.stack.split(`
`);let o=s.findIndex(m=>m!=="Error"&&!m.includes("audiograph.mjs"));s[o].includes("gainNode")&&o++,s[o].includes("getWorklet")&&o++;const a=s[o].replace(/\s*at\s/,"").replace("http","@");let c;return c=a.match(/([^@]*)@.*packages(\/[^:]+:\d+:\d+)/),c?c[1].replace(/[^.:/a-zA-Z0-9]/g,"")+"@"+c[2].replace(/[^.:/a-zA-Z0-9]/g,""):"@"}let le=0;const pe=t=>{Object.defineProperty(t.prototype,"audioid",{get:function(){if(!this._audioid){this._audioid=++le;const n=JSON.parse(is);n.type=this.constructor.name==="AudiographNode"?this.constructor._parentClassName:this.constructor.name,["FeedbackDelayNode","VowelNode"].indexOf(n.type)===-1&&(n.hasStop=window[n.type].prototype instanceof AudioScheduledSourceNode),n.ac=this.context?.constructor.name||"AudioParam",n.creation=n.creation||fe(),R.set(this._audioid,n)}return this._audioid},enumerable:!1,configurable:!0})},ls=t=>{const n=t.prototype.constructor.name,s=class extends t{constructor(...a){super(...a),this._audioid=this.audioid}};s._parentClassName=n,window[n]=s},Le=async function(t){const n=document.querySelector(".strudel-mermaid");let s="";s+=`---
`,s+=`config:
`,s+=`  flowchart:
`,s+=`    wrappingWidth: 600
`,s+=`---
`,s+=`flowchart LR
`,s+="id["+t.replaceAll(" ","&nbsp;")+`]
`;let{svg:o}=await ie.render("strudelSvgId",s);o=o.replace(/max-width:\s[0-9.]*px;/i,"height: 100%"),o=o.replaceAll("&amp;nbsp;"," "),n.innerHTML=o},nt=async function(){const t=document.querySelector(".strudel-mermaid");let n=window.strudelMirror.code;n=n.replace(/^await debugAudiograph.*\n?/gm,""),n="// date: "+new Date().toISOString()+`

`+n,n="// host: "+document.location.hostname+`
`+n;const s=n.split(/(?:\n|\r\n?)/),o=s.reduce((d,r)=>Math.max(d,r.length),0);let a="";a+=`---
`,a+=`config:
`,a+=`  flowchart:
`,a+="    wrappingWidth: "+14*o+`
`,a+=`---
`,a+=`flowchart TB
`,a+=`	subgraph AG[STRUDEL AUDIOGRAPH]
`;let c=[];R.forEach((d,r)=>{d.connect.length===0&&c.push(r)});const m=[];let u;const f=d=>d==="@"?d:d.replace("@",`
`).replace("/superdough/","/"),l=d=>{const r=d.creation?`
`+f(d.creation):"";let w="[**"+d.type+"**"+r+"]";return d.ac==="OfflineAudioContext"&&(w="["+w+"]"),w},i=d=>["AudioDestinationNode","AudioParam"].indexOf(d.type)===-1&&d.disconnectAll===0&&d.connect.length>d.disconnectOne,h=d=>d.hasStop&&d.stopCount===0;do u=m.length,c.slice().forEach(d=>{R.forEach((r,w)=>{r.connect.indexOf(d)!==-1&&(c.indexOf(w)===-1&&c.push(w),a+=r.connect.map(j=>{if(c.indexOf(j)===-1&&c.push(j),m.indexOf(w+"-"+j)===-1)return m.push(w+"-"+j),"		node"+w+l(r)+" -- "+f(r.where[0])+" --> node"+j+l(R.get(j))+`
`}).join("")),w===d&&(a+=r.connect.map(j=>{if(c.indexOf(j)===-1&&c.push(j),m.indexOf(w+"-"+j)===-1)return m.push(w+"-"+j),"		node"+w+l(r)+" -- "+f(r.where[0])+" --> node"+j+l(R.get(j))+`
`}).join(""))})});while(m.length>u);const x="-"+m.join("-")+"-";R.forEach((d,r)=>{x.includes("-"+r+"-")||(a+="		node"+r+l(d)+`
`)});const S="m".repeat(o);a+=`	subgraph LEGEND
`,a+=`		legend1[in AudioContext]
`,a+=`		legend2[[in OfflineAudioContext]]
`,a+=`		legend3[not disconnected]
`,a+=`		legend4[AudioParam]
`,a+=`		legend5[AudioDestinationNode]
`,a+=`		legend6[not stopped]
`,a+=`	end
`,a+=`	subgraph CODE[Strudel Code]
`,a+=`
code[`+(S+"<br>").repeat(s.length)+`]
`,a+=`	end
`,a+=`	end
`,a+=`	classDef audioparam fill:#6f6;
`,a+=`	classDef destination fill:#99f;
`,a+=`	classDef connectleak fill:#f96,stroke:#f00,stroke-width:2px;
`,a+=`	classDef stopleak fill:#f55,stroke:#f00,stroke-width:2px;
`,a+=`	class legend3 connectleak;
`,a+=`	class legend4 audioparam;
`,a+=`	class legend5 destination;
`,a+=`	class legend6 stopleak;
`,R.forEach((d,r)=>{i(d)?a+="	class node"+r+` connectleak;
`:h(d)&&(a+="	class node"+r+` stopleak;
`),d.type==="AudioParam"&&(a+="	class node"+r+` audioparam;
`),d.type==="AudioDestinationNode"&&(a+="	class node"+r+` destination;
`)});let{svg:y}=await ie.render("strudelSvgId",a),p=0;const E=d=>d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");y=y.replaceAll(S,()=>E(s[p++])),y=y.replace(/max-width:\s[0-9.]*px;/i,"height: 100%"),t.innerHTML=y,document.querySelector("[id^=flowchart-code] text").setAttributeNS(null,"style","text-anchor: start;");const T=document.querySelector("svg"),D=document.querySelector("svg [id^=flowchart-code] .label").transform.baseVal,b=T.createSVGTransform();let X=Array.from(document.querySelectorAll("[id^=flowchart-code] tspan.text-inner-tspan")).reduce((d,r)=>Math.max(d,r.getComputedTextLength()),0);b.setTranslate(-X/2,0),D.appendItem(b);let H=!1,K,q,k;K={haltEventListeners:["mousedown","mousemove","mouseup"],mouseDownHandler:function(d){event.target.className=="[object SVGAnimatedString]"&&(H=!0,k={x:d.clientX,y:d.clientY})},mouseMoveHandler:function(d){H&&(q.panBy({x:d.clientX-k.x,y:d.clientY-k.y}),k={x:d.clientX,y:d.clientY},window.getSelection().removeAllRanges())},mouseUpHandler:function(d){H=!1},init:function(d){d.svgElement.addEventListener("mousedown",this.mouseDownHandler,!1),d.svgElement.addEventListener("mousemove",this.mouseMoveHandler,!1),d.svgElement.addEventListener("mouseup",this.mouseUpHandler,!1)},destroy:function(d){d.svgElement.removeEventListener("mousedown",this.mouseDownHandler,!1),d.svgElement.removeEventListener("mousemove",this.mouseMoveHandler,!1),d.svgElement.removeEventListener("mouseup",this.mouseUpHandler,!1)}},q=tt("#strudelSvgId",{zoomEnabled:!0,controlIconsEnabled:!0,fit:1,center:1,zoomScaleSensitivity:.4,customEventsHandler:K})},cs=async()=>{const t=document.createElement("a");document.body.appendChild(t),t.style="display: none";const n=".strudel-mermaid",s=document.querySelector("svg g").getBBox();let o,a;const c=document.querySelector(".svg-pan-zoom_viewport");c&&(o=c.transform,a=c.style,c.setAttribute("transform",""),c.style="");const u="<![CDATA["+await fetch("https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.2/dist/svg-pan-zoom.min.js").then(h=>h.text())+';svgPanZoom("svg");]]>',f=document.querySelector(n).innerHTML.replaceAll("<br>","<br/>").replace(/<g id="svg-pan-zoom.*<\/g>/,"<script>"+u+"<\/script>").replace(/<defs>.*<\/defs>/,"").replace('width="100%"','width="'+s.width+'" height="'+s.height+'"');c&&(c.setAttribute("transform",o),c.style=a);var l=new Blob([f],{type:"image/svg+xml"}),i=window.URL.createObjectURL(l);t.href=i,t.download="audiograph.svg",t.click(),window.URL.revokeObjectURL(i)},ge=function(t){const n=re().destination;n._audioid&&delete n._audioid,Zt().reset(),Array.from(R.keys()).map(o=>{o<=t&&R.delete(o)})},ds=async function(){W=0,await nt(),ge(le)},us={StopAfterHapCount:10,hapsBatch:0,maxEdges:1e4,maxTextSize:2e5,audioAPIBreathingRoomSec:5},ps=async(t={})=>{const n=Object.assign({},us,t),{StopAfterHapCount:s,hapsBatch:o,maxEdges:a,maxTextSize:c,audioAPIBreathingRoomSec:m}=n,u=window.strudelMirror,f=u.code;if(!f.match(/await\s+debugAudiograph/))throw new Error("you need to call `await debugAudiograph()` for audiograph to work");const l=/await\s+debugAudiograph\(\)/.exec(f);if(l){const i=l.index+l[0].length-1,h=JSON.stringify({StopAfterHapCount:s}).replaceAll('"',"");u.setCode(f.slice(0,i)+h+f.slice(i))}if(window.audiograph===void 0){window.audiograph={},Ie=u.toggle,pe(AudioNode),pe(AudioParam),pe(PeriodicWave),[AudioBufferSourceNode,AudioWorkletNode,AnalyserNode,BiquadFilterNode,ChannelMergerNode,ChannelSplitterNode,ConstantSourceNode,ConvolverNode,DelayNode,DynamicsCompressorNode,GainNode,IIRFilterNode,OscillatorNode,PannerNode,StereoPannerNode,WaveShaperNode].map(p=>{if(p.prototype instanceof AudioScheduledSourceNode){const E=p.prototype.stop;p.prototype.stop=function(...A){const T=E.call(this,...A),_=R.get(this.audioid);return _.stopCount++,T}}ls(p)}),Object.getOwnPropertyNames(BaseAudioContext.prototype).filter(p=>p.startsWith("create")&&["createBuffer"].indexOf(p)===-1).map(p=>{const E=BaseAudioContext.prototype[p];BaseAudioContext.prototype[p]=function(...A){const T=E.call(this,...A),_=R.get(T.audioid);return _.creation=fe(),T}});const h=AudioNode.prototype.connect;AudioNode.prototype.connect=function(p,...E){const A=h.call(this,p,...E),T=R.get(this.audioid);return T.connect.push(p.audioid),T.where.push(fe()),A};const x=AudioNode.prototype.disconnect;AudioNode.prototype.disconnect=function(p,...E){const A=x.call(this,p,...E),T=R.get(this.audioid);return T.connect.length?p?T.disconnectOne++:T.disconnectAll++:(oe("WEIRD: node "+this.audioid+"called disconnect before any call to connect !"),console.log(R)),A},ge(le),ge(le);const{default:S}=await Ae(async()=>{const{default:p}=await import("https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.esm.mjs");return{default:p}},[]);ie=S,ie.initialize({startOnLoad:!1,themeCSS:".flowchart { height: 100%; }",maxEdges:a,maxTextSize:c,htmlLabels:!1,flowchart:{htmlLabels:!1}});const{default:y}=await Ae(async()=>{const{default:p}=await import("https://esm.sh/svg-pan-zoom");return{default:p}},[]);if(tt=y,!document.querySelector(".strudel-mermaid")){const p=document.createElement("div");p.className="strudel-mermaid",p.style="min-height: 600px; width: 60%";const E=document.querySelector("#code");E.parentNode.insertBefore(p,E.nextSibling)}if(!document.querySelector("button[title=svg]")){const p=document.createElement("button");p.innerHTML="<span>ExportDiagram</span>",p.title="svg",p.onclick=cs;const E=document.querySelector("button[title=update]");E.parentNode.insertBefore(p,E)}}if(te||(te=!0),o===0||W<o){let i="";i+="Recording activity...",i+=`
press stop to build diagram`,s&&(i+=`
will stop automatically in `+Math.max(s-W,0)+" haps"),await Le(i)}u.toggle=async()=>{te=!1,u.toggle=Ie,setTimeout(u.toggle.bind(u),0),await Le("please wait "+m+` seconds
the audio API is finishing its work`),setTimeout(ds,m*1e3)},all(i=>i.onTrigger(async(h,x,S,y)=>{if(W++,Object.entries(h.value).map(p=>p.join("/")).join("/"),s&&W>s){te&&await u.toggle();return}await $e(h,y,h.duration/S,S,y),o&&W%o===0&&nt()}))},{latestCode:De,maxPolyphony:ms,audioDeviceName:hs,multiChannelOrbits:fs}=v.get();let ce,st,ne,at,ot;typeof window<"u"&&(ot=Gt({maxPolyphony:ms,audioDeviceName:hs,multiChannelOrbits:wt(fs)}),ce=bt(),st=be(),ne=He(),at=()=>ne.clearRect(0,0,ne.canvas.height,ne.canvas.width));async function gs(t){return ce?(await ce).find(s=>s.packageName===t):void 0}const xs="// LOADING";function bs(){const{isSyncEnabled:t,audioEngineTarget:n,prebakeScript:s,includePrebakeScriptInShare:o}=O(),a=n!==$.osc,c=a?$e:Xn,m=a?Xt:Dt,u=g.useCallback(()=>{const k=[-2,2],d=He(),r=new $t({sync:t,defaultOutput:c,getTime:m,setInterval:rs,clearInterval:os,transpiler:Ue,autodraw:!1,root:E.current,initialCode:xs,pattern:It,drawTime:k,drawContext:d,prebake:async()=>Promise.all([ce,st]).then(()=>{if(s?.length)return sn(s??"")}),onUpdateState:w=>{l({...w})},onToggle:w=>{w||Te()},beforeEval:()=>ot,afterEval:w=>{const{code:j}=w;window.parent?.postMessage(j),yt(j),window.location.hash="#"+Lt(j),T(j);const I=vt();jt(j);const V={...I,code:j};let B=V.id;if(I.collection!==Y.collection){if(j!==I.code){const Se=Y.duplicate(V);B=Se.id,J(Se.data)}}else B=Y.isValidID(B)?B:Nt(),J(Y.update(B,V).data);Ce(B)},bgFill:!1});window.strudelMirror=r,window.debugAudiograph=ps,St().then(async w=>{let j,I;w?(j=w,I="I have loaded the code from the URL."):De?(j=De,I="Your last session has been loaded!"):(j='$: s("[bd <hh oh>]*2").bank("tr909").dec(.4)',I="Default code has been loaded"),r.setCode(j),T(j),oe(`Welcome to Strudel! ${I} Press play or hit ctrl+enter to run it!`,"highlight")}),p.current=r},[]),[f,l]=g.useState({}),{started:i,isDirty:h,error:x,activeCode:S,pending:y}=f,p=g.useRef(),E=g.useRef(),A=xe(v,{keys:Object.keys(Ee)});g.useEffect(()=>{let k={};Object.keys(Ee).forEach(d=>{Object.prototype.hasOwnProperty.call(A,d)&&(k[d]=A[d])}),p.current?.updateSettings(k)},[A]);const T=k=>{const d=Ct(k);document.title=(d.title?`${d.title} - `:"")+"Strudel REPL"},_=async()=>{p.current?.toggle()},D=async()=>{(await gs("@strudel/tonal"))?.resetVoicings(),Qt(),en(),at(),Te(),tn(),p.current.repl.setCps(.5),await be()},b=async(k,d=!1)=>{J(k),p.current.setCode(k.code),d&&(await D(),N())},N=()=>{p.current.evaluate()};return{started:i,pending:y,isDirty:h,activeCode:S,handleTogglePlay:_,handleUpdate:b,handleShuffle:async()=>{const k=await Et(),d=k.code;oe(`[repl] ‚ú® loading random tune "${k.id}"`),Ce(k.id),J(k),await D(),p.current.setCode(d),p.current.repl.evaluate(d)},handleShare:async()=>{let k=f.code;o&&(k=s+`
`+k),kt(k)},handleEvaluate:N,handleExport:async(k,d,r,w,j,I=void 0)=>{await p.current.evaluate(!1),p.current.repl.scheduler.stop(),await Yt(p.current.repl.state.pattern,p.current.repl.scheduler.cps,k,d,r,w,j,I).finally(async()=>{const{latestCode:V,maxPolyphony:B,audioDeviceName:je,multiChannelOrbits:Ne}=v.get();await Jt({latestCode:V,maxPolyphony:B,audioDeviceName:je,multiChannelOrbits:Ne}),p.current.repl.scheduler.stop()})},init:u,error:x,editorRef:p,containerRef:E}}function Os({embedded:t=!1}){const n=t||Tt(),s=Be()?zn:n?Zn:Vn,o=bs(),{fontFamily:a}=O();return e.jsx(s,{context:o,style:{fontFamily:a}})}export{Os as Repl};
